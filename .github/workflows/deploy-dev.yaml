name: Build & Deploy

on:

  push:

    branches:
      - "main"

jobs:

  clone_repo: 

      runs-on: ubuntu-latest

      steps:
        - name: Clone repository
          uses: appleboy/ssh-action@v1.0.0
          with: 
            host: ${{secrets.SSH_HOST}}
            key: ${{secrets.SSH_KEY}}
            username: ${{secrets.SSH_USERNAME}}
        - run: ./deploy/clone.sh

  deploy:

    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: ['16.x', '18.x']

    steps:
      - name: Check for node version
        uses: actions/setup-node@v3
        with:
          node-version: ${{matrix.node-version}}
      - run: npm ci; npm run build; npm run start
      - run: echo 'Successfully deployed'

          
          
        

        
